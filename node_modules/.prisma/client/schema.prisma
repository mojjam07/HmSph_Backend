generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String     @id @default(cuid())
  email     String     @unique
  password  String
  firstName String
  lastName  String
  role      Role       @default(USER)
  avatar    String?
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  agent     Agent?
  favorites Favorite[]
  reviews   Review[]
  contacts  Contact[]
}

model Agent {
  id                 String             @id @default(cuid())
  userId             String             @unique
  licenseNumber      String             @unique
  commissionRate     Float              @default(0.03)
  specialties        String[]
  bio                String?
  phone              String?
  profileImage       String?
  businessName       String?
  isVerified         Boolean            @default(false)
  verificationStatus VerificationStatus @default(PENDING)
  subscriptionPlan   SubscriptionPlan   @default(BASIC)
  listingLimits      Int                @default(25)
  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @updatedAt
  user               User               @relation(fields: [userId], references: [id])
  properties         Property[]
  subscriptions      Subscription[]
  payments           Payment[]
  contacts           Contact[]
}

model Property {
  id            String         @id @default(cuid())
  title         String
  description   String
  price         Int
  address       String
  city          String
  state         String
  zipCode       String
  bedrooms      Int
  bathrooms     Float
  squareFootage Int
  propertyType  PropertyType   @default(HOUSE)
  images        String[]
  status        PropertyStatus @default(ACTIVE)
  agentId       String
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  favorites     Favorite[]
  agent         Agent          @relation(fields: [agentId], references: [id])
  reviews       Review[]
  contacts      Contact[]
}

model Review {
  id         String   @id @default(cuid())
  rating     Int
  comment    String
  propertyId String
  userId     String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  dislikes   Int?     @default(0)
  likes      Int?     @default(0)
  property   Property @relation(fields: [propertyId], references: [id])
  user       User     @relation(fields: [userId], references: [id])
}

model Favorite {
  id         String   @id @default(cuid())
  userId     String
  propertyId String
  createdAt  DateTime @default(now())
  property   Property @relation(fields: [propertyId], references: [id])
  user       User     @relation(fields: [userId], references: [id])

  @@unique([userId, propertyId])
}

enum Role {
  USER
  AGENT
  ADMIN
}

enum PropertyType {
  HOUSE
  APARTMENT
  CONDO
  TOWNHOUSE
  LAND
  COMMERCIAL
}

enum PropertyStatus {
  ACTIVE
  PENDING
  SOLD
  RENTED
  OFF_MARKET
}

enum VerificationStatus {
  PENDING
  APPROVED
  REJECTED
  SUSPENDED
}

enum SubscriptionPlan {
  BASIC
  PRO
  PREMIUM
  ENTERPRISE
}

enum ContactStatus {
  NEW
  CONTACTED
  QUALIFIED
  CONVERTED
  ARCHIVED
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

enum PaymentMethod {
  CARD
  BANK_TRANSFER
  PAYPAL
  FLUTTERWAVE
  PAYSTACK
}

model Contact {
  id          String        @id @default(cuid())
  name        String
  email       String
  phone       String?
  subject     String
  message     String
  inquiryType String
  status      ContactStatus @default(NEW)
  userId      String?
  agentId     String?
  propertyId  String?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  user        User?         @relation(fields: [userId], references: [id])
  agent       Agent?        @relation(fields: [agentId], references: [id])
  property    Property?     @relation(fields: [propertyId], references: [id])

  @@index([email])
  @@index([status])
  @@index([createdAt])
}

model Payment {
  id             String        @id @default(cuid())
  amount         Float
  currency       String        @default("NGN")
  status         PaymentStatus @default(PENDING)
  method         PaymentMethod
  transactionId  String?
  description    String?
  metadata       Json?
  agentId        String
  subscriptionId String?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  agent          Agent         @relation(fields: [agentId], references: [id])
  subscription   Subscription? @relation(fields: [subscriptionId], references: [id])

  @@index([agentId])
  @@index([status])
  @@index([createdAt])
}

model Subscription {
  id        String           @id @default(cuid())
  plan      SubscriptionPlan
  status    PaymentStatus    @default(PENDING)
  startDate DateTime
  endDate   DateTime
  autoRenew Boolean          @default(true)
  price     Float
  currency  String           @default("NGN")
  features  Json?
  agentId   String
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt
  agent     Agent            @relation(fields: [agentId], references: [id])
  payments  Payment[]

  @@index([agentId])
  @@index([status])
  @@index([endDate])
}
